<!-- AUTO MODE COMPONENT -->

<!-- Step Indicator -->
<div class="step-indicator">
    <div class="step active" data-step="1">
        <div class="step-number">1</div>
        <div class="step-label">Upload License</div>
    </div>
    <div class="step" data-step="2">
        <div class="step-number">2</div>
        <div class="step-label">Select Route</div>
    </div>
    <div class="step" data-step="3">
        <div class="step-number">3</div>
        <div class="step-label">Review & Analyze</div>
    </div>
</div>

<!-- STEP 1: License Upload -->
<div class="form-section" id="licenseUploadSection">
    <div class="section-header">
        <h4><i class="fas fa-id-card"></i> Step 1: Upload Driver's License</h4>
    </div>
    
    <div class="upload-zone" id="licenseUploadZone">
        <input type="file" id="licenseInput" accept="image/*" />
        <div class="upload-icon">
            <i class="fas fa-cloud-upload-alt"></i>
        </div>
        <h5>Click or Drag to Upload License</h5>
        <p class="text-muted mb-0">Supports JPG, PNG (Max 5MB)</p>
        <button type="button" class="btn btn-outline-primary mt-3" onclick="document.getElementById('licenseInput').click()">
            <i class="fas fa-folder-open"></i> Browse Files
        </button>
    </div>

    <div id="licensePreview" style="display:none;">
        <img id="licenseImage" class="preview-image" alt="License Preview" />
        <div id="licenseStatus" class="license-status processing">
            <i class="fas fa-spinner fa-spin"></i> Processing license...
        </div>
        <div id="extractedInfo" style="display:none; margin-top:1rem;">
            <div class="alert alert-info">
                <h6><i class="fas fa-info-circle"></i> Extracted Information:</h6>
                <ul id="extractedDataList" class="mb-0"></ul>
            </div>
        </div>
        <button type="button" class="btn btn-sm btn-outline-danger mt-2" onclick="resetLicenseUpload()">
            <i class="fas fa-times"></i> Remove & Upload Different License
        </button>
    </div>
</div>

<!-- STEP 2: Route Selection -->
<div class="form-section" id="routeSelectionSection" style="display:none;">
    <div class="section-header">
        <h4><i class="fas fa-route"></i> Step 2: Select Your Route</h4>
    </div>
    
    <div class="row">
        <div class="col-md-6">
            <label class="form-label">Source Location</label>
            <input type="text" class="form-control" id="autoSourceLocation" placeholder="Enter starting point">
            <button type="button" class="btn btn-sm btn-outline-primary mt-2" onclick="useCurrentLocationAsSource()">
                <i class="fas fa-location-arrow"></i> Use Current Location
            </button>
        </div>
        <div class="col-md-6">
            <label class="form-label">Destination Location</label>
            <input type="text" class="form-control" id="autoDestLocation" placeholder="Enter destination">
        </div>
    </div>

    <div class="route-map-container" id="routeMap">
        <div class="d-flex justify-content-center align-items-center h-100">
            <p class="text-muted"><i class="fas fa-map-marked-alt"></i> Map will load after route selection</p>
        </div>
    </div>

    <button type="button" class="btn btn-primary mt-3" onclick="analyzeRoute()">
        <i class="fas fa-search"></i> Analyze Route & Get Conditions
    </button>
</div>

<!-- STEP 3: Auto-filled Form Review -->
<div class="form-section" id="reviewSection" style="display:none;">
    <div class="section-header">
        <h4><i class="fas fa-check-circle"></i> Step 3: Review Auto-Filled Data</h4>
    </div>
    
    <!-- Weather Widget -->
    <div class="weather-widget" id="weatherWidget" style="display:none;">
        <h5><i class="fas fa-cloud-sun"></i> Current Weather Conditions</h5>
        <div class="row">
            <div class="col-md-3">
                <div><strong>Weather:</strong> <span id="currentWeather">-</span></div>
            </div>
            <div class="col-md-3">
                <div><strong>Temperature:</strong> <span id="currentTemp">-</span></div>
            </div>
            <div class="col-md-3">
                <div><strong>Visibility:</strong> <span id="currentVisibility">-</span></div>
            </div>
            <div class="col-md-3">
                <div><strong>Road Surface:</strong> <span id="roadSurfaceCondition">-</span></div>
            </div>
        </div>
    </div>

    <div class="alert alert-success mt-3">
        <i class="fas fa-magic"></i> <strong>All fields auto-filled!</strong> Review below and edit if needed, then click analyze.
    </div>
</div>

<!-- AUTO MODE FORM -->
<form id="autoModeForm">
    <!-- Location Section -->
    <div class="form-section">
        <div class="section-header">
            <h4>
                <i class="fas fa-map-marker-alt"></i> Location Information
                <span class="auto-filled-badge" id="locationBadge" style="display:none;">
                    <i class="fas fa-bolt"></i> Auto-filled
                </span>
            </h4>
        </div>
        <div class="row">
            <div class="col-md-8">
                <label for="auto_location" class="form-label">Route</label>
                <input type="text" class="form-control" id="auto_location" name="location" placeholder="Auto-filled from route" readonly>
            </div>
            <div class="col-md-4">
                <label for="auto_area_type" class="form-label">Area Type</label>
                <select class="form-select" id="auto_area_type" name="area_type" disabled>
                    <option value="Urban">Urban</option>
                    <option value="Suburban">Suburban</option>
                    <option value="Rural">Rural</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Vehicle & Driver Section -->
    <div class="form-section">
        <div class="section-header">
            <h4>
                <i class="fas fa-car"></i> Vehicle & Driver Details
                <span class="auto-filled-badge" id="driverBadge" style="display:none;">
                    <i class="fas fa-bolt"></i> Auto-filled
                </span>
            </h4>
        </div>
        <div class="row">
            <div class="col-md-4">
                <label for="auto_vehicle_type" class="form-label">Vehicle Type</label>
                <select class="form-select" id="auto_vehicle_type" name="vehicle_type" disabled>
                    <option value="Car">Car</option>
                    <option value="Bike">Motorcycle/Bike</option>
                    <option value="Truck">Truck</option>
                    <option value="Bus">Bus</option>
                    <option value="Auto-rickshaw">Auto-rickshaw</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_driver_age" class="form-label">Driver Age</label>
                <input type="number" class="form-control" id="auto_driver_age" name="driver_age" readonly>
            </div>
            <div class="col-md-4">
                <label for="auto_experience" class="form-label">Driving Experience (years)</label>
                <input type="number" class="form-control" id="auto_experience" name="experience" readonly>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-4">
                <label for="auto_license_valid" class="form-label">Valid License</label>
                <select class="form-select" id="auto_license_valid" name="license_valid" disabled>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_seatbelt" class="form-label">Seatbelt/Helmet</label>
                <select class="form-select" id="auto_seatbelt" name="seatbelt">
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Environmental Conditions -->
    <div class="form-section">
        <div class="section-header">
            <h4>
                <i class="fas fa-cloud-sun"></i> Environmental Conditions
                <span class="auto-filled-badge" id="weatherBadge" style="display:none;">
                    <i class="fas fa-bolt"></i> Auto-filled
                </span>
            </h4>
        </div>
        <div class="row">
            <div class="col-md-3">
                <label for="auto_weather" class="form-label">Weather</label>
                <select class="form-select" id="auto_weather" name="weather" disabled>
                    <option value="Clear">Clear</option>
                    <option value="Rainy">Rainy</option>
                    <option value="Foggy">Foggy</option>
                    <option value="Snowy">Snowy</option>
                    <option value="Stormy">Stormy</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="auto_road_surface" class="form-label">Road Surface</label>
                <select class="form-select" id="auto_road_surface" name="road_surface" disabled>
                    <option value="Dry">Dry</option>
                    <option value="Wet">Wet</option>
                    <option value="Icy">Icy</option>
                    <option value="Muddy">Muddy</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="auto_visibility" class="form-label">Visibility</label>
                <select class="form-select" id="auto_visibility" name="visibility" disabled>
                    <option value="high">High (>200m)</option>
                    <option value="medium">Medium (50-200m)</option>
                    <option value="low">Low (<50m)</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="auto_light_condition" class="form-label">Light Condition</label>
                <select class="form-select" id="auto_light_condition" name="light_condition" disabled>
                    <option value="Daylight">Daylight</option>
                    <option value="Night_with_lights">Night (Street lights)</option>
                    <option value="Night_without_lights">Night (No lights)</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Road & Traffic Section -->
    <div class="form-section">
        <div class="section-header">
            <h4>
                <i class="fas fa-road"></i> Road & Traffic Conditions
                <span class="auto-filled-badge" id="roadBadge" style="display:none;">
                    <i class="fas fa-bolt"></i> Auto-filled
                </span>
            </h4>
        </div>
        <div class="row">
            <div class="col-md-4">
                <label for="auto_road_type" class="form-label">Road Type</label>
                <select class="form-select" id="auto_road_type" name="road_type" disabled>
                    <option value="City_Road">City Road</option>
                    <option value="Highway">Highway</option>
                    <option value="Rural_Road">Rural Road</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_road_design" class="form-label">Road Design</label>
                <select class="form-select" id="auto_road_design" name="road_design" disabled>
                    <option value="Straight">Straight</option>
                    <option value="Curved">Curved</option>
                    <option value="Junction">Junction/Intersection</option>
                    <option value="Roundabout">Roundabout</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_traffic_volume" class="form-label">Traffic Volume</label>
                <select class="form-select" id="auto_traffic_volume" name="traffic_volume" disabled>
                    <option value="Low">Low</option>
                    <option value="Medium">Medium</option>
                    <option value="High">High</option>
                </select>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-6">
                <label for="auto_speed_limit" class="form-label">Speed Limit (km/h)</label>
                <input type="number" class="form-control" id="auto_speed_limit" name="speed_limit" readonly>
            </div>
            <div class="col-md-6">
                <label for="auto_current_speed" class="form-label">Current Speed (km/h)</label>
                <input type="number" class="form-control" id="auto_current_speed" name="current_speed" value="50">
            </div>
        </div>
    </div>

    <!-- Time & Additional Factors -->
    <div class="form-section">
        <div class="section-header">
            <h4>
                <i class="fas fa-clock"></i> Time & Additional Risk Factors
                <span class="auto-filled-badge" id="timeBadge" style="display:none;">
                    <i class="fas fa-bolt"></i> Auto-filled
                </span>
            </h4>
        </div>
        <div class="row">
            <div class="col-md-4">
                <label for="auto_time_of_day" class="form-label">Time of Day</label>
                <select class="form-select" id="auto_time_of_day" name="time_of_day" disabled>
                    <option value="Morning">Morning (6-12)</option>
                    <option value="Afternoon">Afternoon (12-17)</option>
                    <option value="Evening">Evening (17-21)</option>
                    <option value="Night">Night (21-6)</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_is_weekend" class="form-label">Day Type</label>
                <select class="form-select" id="auto_is_weekend" name="is_weekend" disabled>
                    <option value="false">Weekday</option>
                    <option value="true">Weekend</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_accident_history" class="form-label">Recent Accidents in Area</label>
                <input type="number" class="form-control" id="auto_accident_history" name="accident_history" readonly>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-4">
                <label for="auto_overtaking" class="form-label">Overtaking Involved</label>
                <select class="form-select" id="auto_overtaking" name="overtaking">
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_phone_usage" class="form-label">Phone Usage</label>
                <select class="form-select" id="auto_phone_usage" name="phone_usage">
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_alcohol" class="form-label">Alcohol Involvement</label>
                <select class="form-select" id="auto_alcohol" name="alcohol">
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                </select>
            </div>
        </div>
    </div>

    <div class="text-center mt-4">
        <button type="submit" class="btn btn-predict btn-lg">
            <i class="fas fa-brain"></i> Analyze Risk with AI
        </button>
    </div>
</form>

<!-- Loading Animation -->
<div id="auto-loading" class="text-center mt-4" style="display: none;">
    <div class="loading-spinner"></div>
    <p class="mt-3"><i class="fas fa-cogs"></i> AI Model Processing...</p>
    <small class="text-muted">Analyzing auto-filled data...</small>
</div>

<!-- Processing Overlay -->
<div class="processing-overlay" id="processingOverlay">
    <div class="processing-content">
        <div class="processing-spinner"></div>
        <h4 id="processingTitle">Processing...</h4>
        <p id="processingMessage" class="text-muted">Please wait</p>
    </div>
</div>