<!-- AUTO MODE COMPONENT - FULLY UPDATED WITH ALL 3 AUTO-FILL FEATURES -->

<!-- AUTO MODE FORM -->
<form id="autoModeForm">
    
    <!-- Location Section - UPDATED FOR MAPS -->
    <div class="form-section">
        <div class="section-header">
            <h4>
                <i class="fas fa-map-marker-alt"></i> Location Information
                <span class="auto-filled-badge" id="locationBadge" style="display:none;">
                    <i class="fas fa-bolt"></i> Auto-filled
                </span>
            </h4>
        </div>
        
        <!-- Source & Destination Inputs - UPDATED -->
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="auto_source_location" class="form-label">Source Location</label>
                <input type="text" class="form-control" id="auto_source_location" placeholder="Click button to use GPS" readonly>
                <button type="button" class="btn btn-sm btn-success mt-2 w-100" onclick="useCurrentLocationAsSource()">
                    <i class="fas fa-location-arrow"></i> Use Current Location (GPS)
                </button>
            </div>
            <div class="col-md-6">
                <label for="auto_destination_location" class="form-label">Destination Location</label>
                <input type="text" class="form-control" id="auto_destination_location" placeholder="Click button to select on map" readonly>
                <button type="button" class="btn btn-sm btn-primary mt-2 w-100" onclick="openDestinationMapModal()">
                    <i class="fas fa-map-marked-alt"></i> Select Destination on Map
                </button>
            </div>
        </div>

        <!-- Auto-filled fields -->
        <div class="row">
            <div class="col-md-8">
                <label for="auto_location" class="form-label">Route Summary</label>
                <input type="text" class="form-control" id="auto_location" name="location" placeholder="Will be auto-filled from route" readonly>
            </div>
            <div class="col-md-4">
                <label for="auto_area_type" class="form-label">Area Type</label>
                <select class="form-select" id="auto_area_type" name="area_type" disabled>
                    <option value="Urban">Urban</option>
                    <option value="Suburban">Suburban</option>
                    <option value="Rural">Rural</option>
                </select>
            </div>
        </div>

        <!-- Auto-fill Route Button - UPDATED -->
        <div class="text-center mt-3">
            <button type="button" class="btn btn-success btn-sm" onclick="autoFillRouteData()">
                <i class="fas fa-magic"></i> Analyze Route & Auto-Fill Data
            </button>
        </div>
    </div>

    <!-- Vehicle & Driver Section -->
    <div class="form-section">
        <div class="section-header">
            <h4>
                <i class="fas fa-car"></i> Vehicle & Driver Details
                <span class="auto-filled-badge" id="driverBadge" style="display:none;">
                    <i class="fas fa-bolt"></i> Auto-filled
                </span>
            </h4>
        </div>

        <!-- License Upload Option -->
        <div class="alert alert-info mb-3">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <i class="fas fa-id-card"></i> <strong>Quick Fill:</strong> Upload your driver's license to auto-fill this section
                </div>
                <button type="button" class="btn btn-primary btn-sm" onclick="openLicenseUploadModal()">
                    <i class="fas fa-upload"></i> Upload License
                </button>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <label for="auto_vehicle_type" class="form-label">Vehicle Type</label>
                <select class="form-select" id="auto_vehicle_type" name="vehicle_type">
                    <option value="Car">Car</option>
                    <option value="Bike">Motorcycle/Bike</option>
                    <option value="Truck">Truck</option>
                    <option value="Bus">Bus</option>
                    <option value="Auto-rickshaw">Auto-rickshaw</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_driver_age" class="form-label">Driver Age</label>
                <input type="number" class="form-control" id="auto_driver_age" name="driver_age" min="16" max="80" value="30">
            </div>
            <div class="col-md-4">
                <label for="auto_experience" class="form-label">Driving Experience (years)</label>
                <input type="number" class="form-control" id="auto_experience" name="experience" min="0" max="50" value="5">
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-4">
                <label for="auto_license_valid" class="form-label">Valid License</label>
                <select class="form-select" id="auto_license_valid" name="license_valid">
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_seatbelt" class="form-label">Seatbelt/Helmet</label>
                <select class="form-select" id="auto_seatbelt" name="seatbelt">
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Environmental Conditions -->
    <div class="form-section">
        <div class="section-header">
            <h4>
                <i class="fas fa-cloud-sun"></i> Environmental Conditions
                <span class="auto-filled-badge" id="weatherBadge" style="display:none;">
                    <i class="fas fa-bolt"></i> Auto-filled
                </span>
            </h4>
        </div>

        <!-- Auto-fill Weather Option -->
        <div class="alert alert-info mb-3">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <i class="fas fa-cloud"></i> <strong>Quick Fill:</strong> Get current weather conditions automatically
                </div>
                <button type="button" class="btn btn-primary btn-sm" onclick="autoFillWeatherData()">
                    <i class="fas fa-magic"></i> Get Current Weather
                </button>
            </div>
        </div>

        <div class="row">
            <div class="col-md-3">
                <label for="auto_weather" class="form-label">Weather</label>
                <select class="form-select" id="auto_weather" name="weather">
                    <option value="Clear">Clear</option>
                    <option value="Rainy">Rainy</option>
                    <option value="Foggy">Foggy</option>
                    <option value="Snowy">Snowy</option>
                    <option value="Stormy">Stormy</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="auto_road_surface" class="form-label">Road Surface</label>
                <select class="form-select" id="auto_road_surface" name="road_surface">
                    <option value="Dry">Dry</option>
                    <option value="Wet">Wet</option>
                    <option value="Icy">Icy</option>
                    <option value="Muddy">Muddy</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="auto_visibility" class="form-label">Visibility</label>
                <select class="form-select" id="auto_visibility" name="visibility">
                    <option value="high">High (>200m)</option>
                    <option value="medium">Medium (50-200m)</option>
                    <option value="low">Low (<50m)</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="auto_light_condition" class="form-label">Light Condition</label>
                <select class="form-select" id="auto_light_condition" name="light_condition">
                    <option value="Daylight">Daylight</option>
                    <option value="Night_with_lights">Night (Street lights)</option>
                    <option value="Night_without_lights">Night (No lights)</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Road & Traffic Section -->
    <div class="form-section">
        <div class="section-header">
            <h4>
                <i class="fas fa-road"></i> Road & Traffic Conditions
                <span class="auto-filled-badge" id="roadBadge" style="display:none;">
                    <i class="fas fa-bolt"></i> Auto-filled
                </span>
            </h4>
        </div>

        <!-- Auto-fill Route Option -->
        <div class="alert alert-info mb-3">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <i class="fas fa-route"></i> <strong>Quick Fill:</strong> Analyze route conditions automatically from your selected locations
                </div>
                <button type="button" class="btn btn-primary btn-sm" onclick="autoFillRouteData()">
                    <i class="fas fa-magic"></i> Analyze Route
                </button>
            </div>
        </div>

        <div class="row">
            <div class="col-md-4">
                <label for="auto_road_type" class="form-label">Road Type</label>
                <select class="form-select" id="auto_road_type" name="road_type">
                    <option value="City_Road">City Road</option>
                    <option value="Highway">Highway</option>
                    <option value="Rural_Road">Rural Road</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_road_design" class="form-label">Road Design</label>
                <select class="form-select" id="auto_road_design" name="road_design">
                    <option value="Straight">Straight</option>
                    <option value="Curved">Curved</option>
                    <option value="Junction">Junction/Intersection</option>
                    <option value="Roundabout">Roundabout</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_traffic_volume" class="form-label">Traffic Volume</label>
                <select class="form-select" id="auto_traffic_volume" name="traffic_volume">
                    <option value="Low">Low</option>
                    <option value="Medium">Medium</option>
                    <option value="High">High</option>
                </select>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-6">
                <label for="auto_speed_limit" class="form-label">Speed Limit (km/h)</label>
                <input type="number" class="form-control" id="auto_speed_limit" name="speed_limit" min="20" max="120" value="60">
            </div>
            <div class="col-md-6">
                <label for="auto_current_speed" class="form-label">Current Speed (km/h)</label>
                <input type="number" class="form-control" id="auto_current_speed" name="current_speed" min="0" max="150" value="50">
            </div>
        </div>
    </div>

    <!-- Time & Additional Factors -->
    <div class="form-section">
        <div class="section-header">
            <h4>
                <i class="fas fa-clock"></i> Time & Additional Risk Factors
                <span class="auto-filled-badge" id="timeBadge" style="display:none;">
                    <i class="fas fa-bolt"></i> Auto-filled
                </span>
            </h4>
        </div>
        <div class="row">
            <div class="col-md-4">
                <label for="auto_time_of_day" class="form-label">Time of Day</label>
                <select class="form-select" id="auto_time_of_day" name="time_of_day">
                    <option value="Morning">Morning (6-12)</option>
                    <option value="Afternoon">Afternoon (12-17)</option>
                    <option value="Evening">Evening (17-21)</option>
                    <option value="Night">Night (21-6)</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_is_weekend" class="form-label">Day Type</label>
                <select class="form-select" id="auto_is_weekend" name="is_weekend">
                    <option value="false">Weekday</option>
                    <option value="true">Weekend</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_accident_history" class="form-label">Recent Accidents in Area</label>
                <input type="number" class="form-control" id="auto_accident_history" name="accident_history" min="0" max="20" value="0">
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-4">
                <label for="auto_overtaking" class="form-label">Overtaking Involved</label>
                <select class="form-select" id="auto_overtaking" name="overtaking">
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_phone_usage" class="form-label">Phone Usage</label>
                <select class="form-select" id="auto_phone_usage" name="phone_usage">
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                </select>
            </div>
            <div class="col-md-4">
                <label for="auto_alcohol" class="form-label">Alcohol Involvement</label>
                <select class="form-select" id="auto_alcohol" name="alcohol">
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                </select>
            </div>
        </div>
    </div>

    <div class="text-center mt-4">
        <button type="submit" class="btn btn-predict btn-lg">
            <i class="fas fa-brain"></i> Analyze Risk with AI
        </button>
    </div>
</form>

<!-- Loading Animation -->
<div id="auto-loading" class="text-center mt-4" style="display: none;">
    <div class="loading-spinner"></div>
    <p class="mt-3"><i class="fas fa-cogs"></i> AI Model Processing...</p>
    <small class="text-muted">Analyzing auto-filled data...</small>
</div>

<!-- LICENSE UPLOAD MODAL -->
<div class="modal fade" id="licenseUploadModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-id-card"></i> Upload Driver's License</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="upload-zone" id="licenseUploadZone">
                    <input type="file" id="licenseInput" accept="image/*" />
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <h5>Click or Drag to Upload License</h5>
                    <p class="text-muted mb-0">Supports JPG, PNG (Max 5MB)</p>
                    <button type="button" class="btn btn-outline-primary mt-3" onclick="document.getElementById('licenseInput').click()">
                        <i class="fas fa-folder-open"></i> Browse Files
                    </button>
                </div>

                <div id="licensePreview" style="display:none;">
                    <img id="licenseImage" class="preview-image" alt="License Preview" />
                    <div id="licenseStatus" class="license-status processing">
                        <i class="fas fa-spinner fa-spin"></i> Processing license...
                    </div>
                    <div id="extractedInfo" style="display:none; margin-top:1rem;">
                        <div class="alert alert-success">
                            <h6><i class="fas fa-check-circle"></i> Extracted Information:</h6>
                            <ul id="extractedDataList" class="mb-0"></ul>
                        </div>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-danger mt-2" onclick="resetLicenseUpload()">
                        <i class="fas fa-times"></i> Remove & Upload Different License
                    </button>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="applyLicenseData" onclick="applyLicenseDataToForm()" disabled>
                    <i class="fas fa-check"></i> Apply to Form
                </button>
            </div>
        </div>
    </div>
</div>

<!-- WEATHER DISPLAY MODAL -->
<div class="modal fade" id="weatherModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-cloud-sun"></i> Current Weather</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="weatherDetails">
                    <div class="text-center">
                        <div class="loading-spinner"></div>
                        <p>Fetching weather data...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- MAP SELECTION MODAL - NEW -->
<div class="modal fade" id="mapSelectionModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-map-marked-alt"></i> Select Destination on Map</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-info">
                    <i class="fas fa-info-circle"></i> <strong>How to use:</strong> Click anywhere on the map to select your destination point
                </div>
                <div id="destinationMap" style="height: 500px; width: 100%;"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="confirmDestinationBtn" onclick="confirmDestinationSelection()" disabled>
                    <i class="fas fa-check"></i> Confirm Destination
                </button>
            </div>
        </div>
    </div>
</div>

<!-- ROUTE ANALYSIS MODAL - NEW -->
<div class="modal fade" id="routeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title"><i class="fas fa-route"></i> Route Analysis</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="routeDetails">
                    <div class="text-center">
                        <div class="loading-spinner"></div>
                        <p>Analyzing route...</p>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Processing Overlay -->
<div class="processing-overlay" id="processingOverlay">
    <div class="processing-content">
        <div class="processing-spinner"></div>
        <h4 id="processingTitle">Processing...</h4>
        <p id="processingMessage" class="text-muted">Please wait</p>
    </div>
</div>

<!-- ADD THESE SCRIPTS AT THE END OF YOUR HTML FILE (before </body>) -->
<!-- Leaflet for Maps -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<!-- Your JavaScript Files -->
<script src="static/js/maps.js"></script>